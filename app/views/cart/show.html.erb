<div class="page-title">
  <div class="container-fluid">
    <div class="page-title__inner">
      <%= render 'shared/breadcrumbs' %>
      <h1>Cart</h1>
    </div>
  </div>
</div>
<div class="container-fluid">
  <% if @items_by_currencies.any? %>
    <% @items_by_currencies.each_key do |currency| %>
      <div class="cart-items-table">
        <div class="cart-items-table-tbody">
          <% @items_by_currencies[currency].each do |item| %>
            <div class="cart-items-table-tr">
              <div class="cart-items-table-td">
                <%= link_to item.ticket.full_name, ticket_path(item.ticket_id) %>
              </div>
              <div class="cart-items-table-td">
                <%= currency_symbol(item.ticket) %>&nbsp;<%= "%g" % item.ticket.price %>
              </div>
              <div class="cart-items-table-td">
                <%= link_to '-', sub_from_cart_path(ticket: item.ticket.id), :class => 'cart-item-btn' %>&nbsp;<%= item.quantity %>&nbsp;<%= link_to '+', add_to_cart_path(ticket: item.ticket.id), :class => 'cart-item-btn', disabled: (item.ticket.quantity ? item.quantity >= item.ticket.quantity : nil) %>
              </div>
              <div class="cart-items-table-td">
                <%= currency_symbol(item.ticket) %>&nbsp;<%= "%g" % (item.ticket.price * item.quantity) %>
              </div>
              <div class="cart-items-table-td">
                <%= link_to 'X', remove_from_cart_path(ticket: item.ticket.id), :class => 'cart-item-btn', title: "Remove item" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <div class="container-fluid">
        <div class="cart-summary">
          <%= currency_symbol(currency) %>&nbsp;<%= "%g" % (@items_by_currencies[currency].inject(0.0) { |sum, item| sum + item.ticket.price * item.quantity }) %>
        </div>

        <% if Rails.env == 'development' %>
          <%= render partial: 'dev_pay_button', locals: { cart: @cart, currency: currency, cart_items: @items_by_currencies[currency] } %>
        <% else %>
          <%= render partial: 'paypal_button', locals: { cart: @cart, currency: currency, cart_items: @items_by_currencies[currency] } %>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p>No items in the cart.</p>
  <% end %>
</div>
